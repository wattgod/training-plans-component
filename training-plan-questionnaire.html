<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Build Your Training Plan | Gravel God</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Sometype+Mono:wght@400;500;600;700&display=swap" rel="stylesheet" />
    
    <style>
        :root {
            --gg-cream: #F5F5DC;
            --gg-charcoal: #2c2c2c;
            --gg-brown: #59473C;
            --gg-muted: #8C7568;
            --gg-yellow: #F4D03F;
            --gg-turquoise: #4ECDC4;
            --gg-white: #ffffff;
            --gg-red: #e74c3c;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            background: var(--gg-cream);
            color: var(--gg-charcoal);
            font-family: "Sometype Mono", ui-monospace, monospace;
            font-size: 15px;
            line-height: 1.7;
            min-height: 100vh;
        }

        .container { max-width: 720px; margin: 0 auto; padding: 48px 24px; }

        /* Header */
        .header { text-align: center; margin-bottom: 48px; }
        .header-badge {
            display: inline-block;
            background: var(--gg-yellow);
            color: var(--gg-charcoal);
            padding: 8px 20px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            border: 3px solid var(--gg-charcoal);
            box-shadow: 4px 4px 0 var(--gg-charcoal);
            margin-bottom: 20px;
        }
        .header h1 { font-size: 28px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.02em; margin-bottom: 12px; }
        .header-race { font-size: 20px; color: var(--gg-turquoise); font-weight: 700; margin-bottom: 16px; }
        .header p { color: var(--gg-muted); font-size: 14px; max-width: 520px; margin: 0 auto; }

        /* Form */
        .form-card {
            background: var(--gg-white);
            border: 3px solid var(--gg-charcoal);
            box-shadow: 6px 6px 0 var(--gg-charcoal);
            padding: 32px;
            margin-bottom: 24px;
        }

        .section-title {
            font-size: 14px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--gg-charcoal);
            padding-bottom: 8px;
            border-bottom: 2px solid var(--gg-charcoal);
            margin-bottom: 24px;
            margin-top: 8px;
        }
        .section-title:first-of-type { margin-top: 0; }
        
        .section-help {
            font-size: 13px;
            color: var(--gg-muted);
            margin-top: -16px;
            margin-bottom: 20px;
            line-height: 1.5;
        }
        
        .flexible-option {
            background: var(--gg-cream);
            border-style: dashed;
        }

        .form-group { margin-bottom: 20px; }
        .form-label { display: block; font-size: 14px; font-weight: 600; margin-bottom: 8px; color: var(--gg-charcoal); }
        .form-label .required { color: var(--gg-red); }
        .form-label .optional { font-weight: 400; color: var(--gg-muted); font-size: 12px; }
        .form-help { font-size: 12px; color: var(--gg-muted); margin-top: 4px; }

        input[type="text"], input[type="email"], input[type="number"], input[type="date"], select, textarea {
            width: 100%;
            padding: 12px 14px;
            border: 2px solid var(--gg-charcoal);
            background: var(--gg-white);
            color: var(--gg-charcoal);
            font-family: inherit;
            font-size: 14px;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--gg-turquoise);
            box-shadow: 3px 3px 0 var(--gg-turquoise);
        }
        input.error, select.error { border-color: var(--gg-red); }
        textarea { min-height: 80px; resize: vertical; }
        select {
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%232c2c2c' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            padding-right: 36px;
        }

        /* Radio/Checkbox groups */
        .radio-group { display: flex; flex-direction: column; gap: 10px; }
        .radio-group.horizontal { flex-direction: row; flex-wrap: wrap; gap: 10px; }
        .radio-option {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 12px 16px;
            border: 2px solid var(--gg-charcoal);
            cursor: pointer;
            transition: background 0.2s, border-color 0.2s;
        }
        .radio-group.horizontal .radio-option { flex: 1; min-width: 100px; }
        .radio-option:hover { background: var(--gg-cream); }
        .radio-option.selected { background: var(--gg-cream); border-color: var(--gg-turquoise); }
        .radio-option input { margin-top: 2px; accent-color: var(--gg-turquoise); }
        .radio-label { flex: 1; }
        .radio-title { font-weight: 600; font-size: 14px; }
        .radio-desc { font-size: 12px; color: var(--gg-muted); margin-top: 2px; }

        /* Checkbox */
        .checkbox-group { 
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(90px, 1fr));
            gap: 8px;
        }
        .checkbox-option {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 10px 12px;
            border: 2px solid var(--gg-charcoal);
            cursor: pointer;
            font-size: 13px;
            transition: background 0.2s, border-color 0.2s;
            min-height: 40px;
        }
        .checkbox-option:hover { background: var(--gg-cream); }
        .checkbox-option.selected { background: var(--gg-cream); border-color: var(--gg-turquoise); }
        .checkbox-option input { accent-color: var(--gg-turquoise); }

        /* Inline fields */
        .inline-fields { display: flex; gap: 16px; }
        .inline-fields .form-group { flex: 1; }
        .inline-fields-3 { display: flex; gap: 12px; }
        .inline-fields-3 .form-group { flex: 1; }
        .inline-fields-4 { display: flex; gap: 10px; }
        .inline-fields-4 .form-group { flex: 1; }

        .input-with-unit { display: flex; align-items: center; gap: 8px; }
        .input-with-unit input { flex: 1; }
        .input-unit { font-size: 13px; color: var(--gg-muted); white-space: nowrap; }


        /* Calculated metrics display */
        .calc-display {
            background: var(--gg-cream);
            border: 2px solid var(--gg-charcoal);
            padding: 12px 16px;
            margin-top: 12px;
            font-size: 13px;
        }
        .calc-row { display: flex; justify-content: space-between; margin: 4px 0; }
        .calc-label { color: var(--gg-muted); }
        .calc-value { font-weight: 700; color: var(--gg-charcoal); }
        .calc-value.highlight { color: var(--gg-turquoise); }

        /* Submit button */
        .submit-btn {
            display: block;
            width: 100%;
            background: var(--gg-turquoise);
            color: var(--gg-charcoal);
            padding: 18px 32px;
            font-family: inherit;
            font-size: 16px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border: 3px solid var(--gg-charcoal);
            box-shadow: 6px 6px 0 var(--gg-charcoal);
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.1s;
            margin-top: 8px;
        }
        .submit-btn:hover { transform: translate(3px, 3px); box-shadow: 3px 3px 0 var(--gg-charcoal); }
        .submit-btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; box-shadow: 6px 6px 0 var(--gg-charcoal); }

        /* Price footer */
        .price-footer { text-align: center; margin-top: 24px; }
        .price { font-size: 28px; font-weight: 700; color: var(--gg-charcoal); }
        .price span { font-size: 14px; color: var(--gg-brown); font-weight: 400; }
        .delivery { 
            font-size: 14px; 
            color: var(--gg-charcoal); 
            margin-top: 16px; 
            max-width: 520px; 
            margin-left: auto; 
            margin-right: auto;
            line-height: 1.7;
        }

        /* Messages */
        .message { padding: 16px 20px; margin-bottom: 24px; border: 3px solid; font-size: 14px; }
        .message.success { background: #d4edda; border-color: #28a745; color: #155724; }
        .message.error { background: #f8d7da; border-color: #dc3545; color: #721c24; }
        .message.warning { background: #fff3cd; border-color: #ffc107; color: #856404; }

        .hidden { display: none !important; }
        .honeypot { position: absolute; left: -9999px; }

        /* Responsive */
        @media (max-width: 600px) {
            .container { padding: 24px 16px; }
            .form-card { padding: 24px 20px; }
            .inline-fields, .inline-fields-3, .inline-fields-4 { flex-direction: column; gap: 0; }
            .radio-group.horizontal { flex-direction: column; }
            .radio-group.horizontal .radio-option { min-width: auto; }
            .header h1 { font-size: 24px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-badge">◆ Custom Training Plan</div>
            <h1>Build Your Plan</h1>
            <div class="header-race" id="race-display">Loading...</div>
            <p>Fill out this form and I'll build a custom training plan calibrated to your goals, schedule, and fitness level. Plans delivered same day.</p>
        </div>

        <div id="message" class="message hidden"></div>

        <form id="training-plan-form" class="form-card">
            <input type="text" name="website" class="honeypot" tabindex="-1" autocomplete="off">
            <input type="hidden" name="race_slug" id="race_slug" value="">
            <input type="hidden" name="race_name" id="race_name" value="">
            <input type="hidden" name="form_type" value="training_plan">
            <!-- Calculated fields populated by JS -->
            <input type="hidden" name="watts_per_kg" id="watts_per_kg" value="">
            <input type="hidden" name="estimated_category" id="estimated_category" value="">
            <input type="hidden" name="weeks_until_race" id="weeks_until_race" value="">
            <input type="hidden" name="blindspots" id="blindspots" value="">

            <!-- ==================== SECTION 1: CONTACT ==================== -->
            <div class="section-title">1. Contact Info</div>
            
            <div class="inline-fields">
                <div class="form-group">
                    <label class="form-label" for="name">Name <span class="required">*</span></label>
                    <input type="text" id="name" name="name" required placeholder="First Last">
                </div>
                <div class="form-group">
                    <label class="form-label" for="email">Email <span class="required">*</span></label>
                    <input type="email" id="email" name="email" required placeholder="you@email.com">
                </div>
            </div>

            <!-- ==================== SECTION 2: ABOUT YOU ==================== -->
            <div class="section-title">2. About You</div>
            <p class="section-help">Basic info to help calibrate your plan. Used for zone calculations and recovery planning.</p>

            <div class="inline-fields-4">
                <div class="form-group">
                    <label class="form-label" for="sex">Sex <span class="required">*</span></label>
                    <select id="sex" name="sex" required>
                        <option value="">Select</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label" for="age">Age <span class="required">*</span></label>
                    <input type="number" id="age" name="age" required placeholder="35" min="16" max="90">
                </div>
                <div class="form-group">
                    <label class="form-label" for="weight">Weight <span class="required">*</span></label>
                    <div class="input-with-unit">
                        <input type="number" id="weight" name="weight" required placeholder="165" min="80" max="350">
                        <span class="input-unit">lbs</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Height <span class="required">*</span></label>
                    <div class="input-with-unit">
                        <input type="number" id="height_ft" name="height_ft" required placeholder="5" min="4" max="7" style="width: 50px;">
                        <span class="input-unit">'</span>
                        <input type="number" id="height_in" name="height_in" required placeholder="10" min="0" max="11" style="width: 50px;">
                        <span class="input-unit">"</span>
                    </div>
                </div>
            </div>

            <div class="inline-fields">
                <div class="form-group">
                    <label class="form-label" for="years_cycling">Years Cycling <span class="required">*</span></label>
                    <select id="years_cycling" name="years_cycling" required>
                        <option value="">Select...</option>
                        <option value="0-1">Less than 1 year</option>
                        <option value="1-3">1-3 years</option>
                        <option value="3-5">3-5 years</option>
                        <option value="5-10">5-10 years</option>
                        <option value="10+">10+ years</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label" for="sleep_quality">Typical Sleep <span class="required">*</span></label>
                    <select id="sleep_quality" name="sleep_quality" required>
                        <option value="">Select...</option>
                        <option value="excellent">Excellent (7-9 hrs, wake refreshed)</option>
                        <option value="good">Good (6-7 hrs, mostly rested)</option>
                        <option value="fair">Fair (5-6 hrs, often tired)</option>
                        <option value="poor">Poor (< 5 hrs, always tired)</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label" for="stress_level">Life Stress Level <span class="required">*</span></label>
                <select id="stress_level" name="stress_level" required>
                    <option value="">Select...</option>
                    <option value="low">Low - Life is chill, training is my stress relief</option>
                    <option value="moderate">Moderate - Normal work/life demands</option>
                    <option value="high">High - Demanding job, family obligations, limited bandwidth</option>
                    <option value="very_high">Very High - Barely keeping head above water</option>
                </select>
                <div class="form-help">Be honest—this affects recovery recommendations. No judgment.</div>
            </div>

            <!-- ==================== SECTION 3: RACE DETAILS ==================== -->
            <div class="section-title">3. Race Details</div>
            
            <div class="inline-fields">
                <div class="form-group">
                    <label class="form-label" for="race_date">Race Date <span class="required">*</span></label>
                    <input type="date" id="race_date" name="race_date" required>
                    <div class="form-help" id="race-date-help"></div>
                </div>
                <div class="form-group">
                    <label class="form-label" for="race_distance">Distance</label>
                    <select id="race_distance" name="race_distance">
                        <option value="">Select...</option>
                        <option value="50mi">~50 miles</option>
                        <option value="100mi">~100 miles</option>
                        <option value="150mi">~150 miles</option>
                        <option value="200mi">~200 miles</option>
                        <option value="other">Other</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Your Goal <span class="required">*</span></label>
                <div class="radio-group">
                    <label class="radio-option">
                        <input type="radio" name="race_goal" value="survive" required>
                        <div class="radio-label">
                            <div class="radio-title">Survive</div>
                            <div class="radio-desc">Just finish. Don't care how it feels. Get across the line.</div>
                        </div>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="race_goal" value="finish">
                        <div class="radio-label">
                            <div class="radio-title">Finish Strong</div>
                            <div class="radio-desc">Complete the race feeling decent, not destroyed</div>
                        </div>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="race_goal" value="compete">
                        <div class="radio-label">
                            <div class="radio-title">Compete</div>
                            <div class="radio-desc">Race for a solid placing in my category</div>
                        </div>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="race_goal" value="podium">
                        <div class="radio-label">
                            <div class="radio-title">Podium</div>
                            <div class="radio-desc">Gun for top 10 or age group podium</div>
                        </div>
                    </label>
                </div>
            </div>

            <!-- ==================== SECTION 4: CURRENT FITNESS ==================== -->
            <div class="section-title">4. Current Fitness</div>
            <p class="section-help">Helps set appropriate training zones and progression. Don't worry if you don't know exact numbers—estimates work.</p>

            <div class="form-group">
                <label class="form-label">Longest Ride in Last 4 Weeks <span class="required">*</span></label>
                <div class="radio-group horizontal">
                    <label class="radio-option">
                        <input type="radio" name="longest_ride" value="under-2" required>
                        <div class="radio-label"><div class="radio-title">&lt; 2 hrs</div></div>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="longest_ride" value="2-4">
                        <div class="radio-label"><div class="radio-title">2-4 hrs</div></div>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="longest_ride" value="4-6">
                        <div class="radio-label"><div class="radio-title">4-6 hrs</div></div>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="longest_ride" value="6+">
                        <div class="radio-label"><div class="radio-title">6+ hrs</div></div>
                    </label>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Power & Heart Rate <span class="optional">(if known - helps dial in zones)</span></label>
                <div class="inline-fields-4" style="margin-top: 8px;">
                    <div class="form-group" style="margin-bottom: 0;">
                        <div class="input-with-unit">
                            <input type="number" id="ftp" name="ftp" placeholder="FTP" min="50" max="500">
                            <span class="input-unit">W</span>
                        </div>
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <div class="input-with-unit">
                            <input type="number" id="hr_max" name="hr_max" placeholder="Max" min="120" max="220">
                            <span class="input-unit">bpm</span>
                        </div>
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <div class="input-with-unit">
                            <input type="number" id="hr_threshold" name="hr_threshold" placeholder="LTHR" min="100" max="200">
                            <span class="input-unit">bpm</span>
                        </div>
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <div class="input-with-unit">
                            <input type="number" id="hr_resting" name="hr_resting" placeholder="Rest" min="30" max="100">
                            <span class="input-unit">bpm</span>
                        </div>
                    </div>
                </div>
                <div id="calc-display" class="calc-display hidden">
                    <div class="calc-row">
                        <span class="calc-label">Power-to-Weight:</span>
                        <span class="calc-value highlight" id="calc-wpkg">—</span>
                    </div>
                    <div class="calc-row">
                        <span class="calc-label">Estimated Category:</span>
                        <span class="calc-value" id="calc-category">—</span>
                    </div>
                </div>
            </div>

            <!-- ==================== SECTION 5: SCHEDULE ==================== -->
            <div class="section-title">5. Your Schedule</div>
            <p class="section-help">Your real-life constraints. I'll structure the plan around YOUR week, not the other way around.</p>

            <div class="inline-fields">
                <div class="form-group">
                    <label class="form-label" for="hours_per_week">Weekly Training Hours <span class="required">*</span></label>
                    <select id="hours_per_week" name="hours_per_week" required>
                        <option value="">Select...</option>
                        <option value="3-5">3-5 hours</option>
                        <option value="5-7">5-7 hours</option>
                        <option value="8-10">8-10 hours</option>
                        <option value="10-12">10-12 hours</option>
                        <option value="12-15">12-15 hours</option>
                        <option value="15+">15+ hours</option>
                    </select>
                    <div class="form-help">Realistic weekly commitment</div>
                </div>
                <div class="form-group">
                    <label class="form-label" for="trainer_access">Indoor Trainer <span class="required">*</span></label>
                    <select id="trainer_access" name="trainer_access" required>
                        <option value="">Select...</option>
                        <option value="yes-smart">Smart trainer (Zwift, etc.)</option>
                        <option value="yes-basic">Basic trainer</option>
                        <option value="no">Outdoor only</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Best Day(s) for Long Rides <span class="required">*</span></label>
                <div class="form-help" style="margin-bottom: 10px;">Select all days that work for your long ride, or choose flexible</div>
                <div class="checkbox-group">
                    <label class="checkbox-option flexible-option"><input type="checkbox" name="long_ride_days" value="flexible"> Flexible</label>
                    <label class="checkbox-option"><input type="checkbox" name="long_ride_days" value="monday"> Mon</label>
                    <label class="checkbox-option"><input type="checkbox" name="long_ride_days" value="tuesday"> Tue</label>
                    <label class="checkbox-option"><input type="checkbox" name="long_ride_days" value="wednesday"> Wed</label>
                    <label class="checkbox-option"><input type="checkbox" name="long_ride_days" value="thursday"> Thu</label>
                    <label class="checkbox-option"><input type="checkbox" name="long_ride_days" value="friday"> Fri</label>
                    <label class="checkbox-option"><input type="checkbox" name="long_ride_days" value="saturday"> Sat</label>
                    <label class="checkbox-option"><input type="checkbox" name="long_ride_days" value="sunday"> Sun</label>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Best Day(s) for Hard Intervals <span class="required">*</span></label>
                <div class="form-help" style="margin-bottom: 10px;">When do you feel freshest for intense efforts? Select all that work, or flexible.</div>
                <div class="checkbox-group">
                    <label class="checkbox-option flexible-option"><input type="checkbox" name="interval_days" value="flexible"> Flexible</label>
                    <label class="checkbox-option"><input type="checkbox" name="interval_days" value="monday"> Mon</label>
                    <label class="checkbox-option"><input type="checkbox" name="interval_days" value="tuesday"> Tue</label>
                    <label class="checkbox-option"><input type="checkbox" name="interval_days" value="wednesday"> Wed</label>
                    <label class="checkbox-option"><input type="checkbox" name="interval_days" value="thursday"> Thu</label>
                    <label class="checkbox-option"><input type="checkbox" name="interval_days" value="friday"> Fri</label>
                    <label class="checkbox-option"><input type="checkbox" name="interval_days" value="saturday"> Sat</label>
                    <label class="checkbox-option"><input type="checkbox" name="interval_days" value="sunday"> Sun</label>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Required Off Days</label>
                <div class="form-help" style="margin-bottom: 10px;">Days you absolutely cannot train (family, work, etc.). Leave unchecked if flexible.</div>
                <div class="checkbox-group">
                    <label class="checkbox-option"><input type="checkbox" name="off_days" value="monday"> Mon</label>
                    <label class="checkbox-option"><input type="checkbox" name="off_days" value="tuesday"> Tue</label>
                    <label class="checkbox-option"><input type="checkbox" name="off_days" value="wednesday"> Wed</label>
                    <label class="checkbox-option"><input type="checkbox" name="off_days" value="thursday"> Thu</label>
                    <label class="checkbox-option"><input type="checkbox" name="off_days" value="friday"> Fri</label>
                    <label class="checkbox-option"><input type="checkbox" name="off_days" value="saturday"> Sat</label>
                    <label class="checkbox-option"><input type="checkbox" name="off_days" value="sunday"> Sun</label>
                </div>
            </div>

            <!-- ==================== SECTION 6: STRENGTH TRAINING ==================== -->
            <div class="section-title">6. Strength Training</div>
            <p class="section-help">Strength work improves durability and power. Not required, but helpful for long events.</p>

            <div class="form-group">
                <label class="form-label">Current Strength Training <span class="required">*</span></label>
                <div class="radio-group">
                    <label class="radio-option">
                        <input type="radio" name="strength_current" value="none" required>
                        <div class="radio-label">
                            <div class="radio-title">None</div>
                            <div class="radio-desc">I don't do any strength work currently</div>
                        </div>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="strength_current" value="occasional">
                        <div class="radio-label">
                            <div class="radio-title">Occasional</div>
                            <div class="radio-desc">Once a week or less, not consistent</div>
                        </div>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="strength_current" value="regular">
                        <div class="radio-label">
                            <div class="radio-title">Regular</div>
                            <div class="radio-desc">1-2x per week, consistent routine</div>
                        </div>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="strength_current" value="dedicated">
                        <div class="radio-label">
                            <div class="radio-title">Dedicated</div>
                            <div class="radio-desc">2-3x per week, structured program</div>
                        </div>
                    </label>
                </div>
            </div>

            <div class="inline-fields">
                <div class="form-group">
                    <label class="form-label">Include Strength? <span class="required">*</span></label>
                    <select id="strength_want" name="strength_want" required>
                        <option value="">Select...</option>
                        <option value="yes">Yes - Include strength sessions</option>
                        <option value="no">No - Cycling only</option>
                        <option value="optional">Your call - You decide</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Equipment <span class="optional">(if including)</span></label>
                    <select id="strength_equipment" name="strength_equipment">
                        <option value="">Select...</option>
                        <option value="full-gym">Full gym access</option>
                        <option value="home-weights">Home weights (dumbbells/kettlebells)</option>
                        <option value="minimal">Minimal (bands/bodyweight)</option>
                        <option value="none">None</option>
                    </select>
                </div>
            </div>

            <!-- ==================== SECTION 7: ADDITIONAL ==================== -->
            <div class="section-title">7. Anything Else</div>
            <p class="section-help">Injuries, travel, constraints—anything that affects how I should structure your plan.</p>

            <div class="form-group">
                <label class="form-label" for="injuries">Injuries or Limitations</label>
                <textarea id="injuries" name="injuries" placeholder="Any injuries, health conditions, or physical limitations? (e.g., bad knee, lower back issues, recovering from surgery)" rows="2"></textarea>
            </div>

            <div class="form-group">
                <label class="form-label" for="notes">Additional Notes</label>
                <textarea id="notes" name="notes" placeholder="Anything else? Travel plans during training, work constraints, specific concerns, past training history..." rows="3"></textarea>
            </div>

            <button type="submit" class="submit-btn" id="submit-btn">
                Submit & Build My Plan →
            </button>
        </form>

        <div class="price-footer">
            <div class="delivery">Extensive gravel racing manual (35,000+ words), structured workouts uploadable to your head unit or Zwift, playbooks for heat, fueling, hydration, pacing, mental training, and race-specific strategy. Delivered same day.</div>
        </div>
    </div>

    <script>
        // Race data lookup - dates updated annually
        const RACES = {
            'unbound-200': { name: 'Unbound 200', date: '2025-06-07', distance: '200mi' },
            'unbound-100': { name: 'Unbound 100', date: '2025-06-07', distance: '100mi' },
            'mid-south': { name: 'Mid South', date: '2025-03-14', distance: '100mi' },
            'sbt-grvl': { name: 'SBT GRVL', date: '2025-08-16', distance: '150mi' },
            'belgian-waffle-ride': { name: 'Belgian Waffle Ride', date: '2025-04-27', distance: '130mi' },
            'leadville-100': { name: 'Leadville 100', date: '2025-08-09', distance: '100mi' },
            // 2026 dates (estimates - update when confirmed)
            'unbound-200-2026': { name: 'Unbound 200', date: '2026-06-06', distance: '200mi' },
            'unbound-100-2026': { name: 'Unbound 100', date: '2026-06-06', distance: '100mi' },
            'mid-south-2026': { name: 'Mid South', date: '2026-03-13', distance: '100mi' },
            'sbt-grvl-2026': { name: 'SBT GRVL', date: '2026-08-15', distance: '150mi' },
            'belgian-waffle-ride-2026': { name: 'Belgian Waffle Ride', date: '2026-04-26', distance: '130mi' }
        };
        
        // Auto-advance to next year's race if current year's date has passed
        function getNextRaceDate(raceSlug) {
            const race = RACES[raceSlug];
            if (!race) return null;
            
            const raceDate = new Date(race.date + 'T00:00:00');
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            // If race date is in the past, try next year's version
            if (raceDate < today) {
                const nextYearSlug = raceSlug + '-2026';
                if (RACES[nextYearSlug]) {
                    return { ...RACES[nextYearSlug], slug: raceSlug };
                }
                // Otherwise bump the year
                const nextYear = new Date(race.date);
                nextYear.setFullYear(nextYear.getFullYear() + 1);
                return { ...race, date: nextYear.toISOString().split('T')[0] };
            }
            
            return race;
        }

        // W/kg category thresholds (male)
        const CATEGORIES_MALE = [
            { min: 5.0, cat: 'Pro / Cat 1', desc: 'Elite level' },
            { min: 4.2, cat: 'Cat 2', desc: 'Very strong amateur' },
            { min: 3.7, cat: 'Cat 3', desc: 'Strong recreational' },
            { min: 3.2, cat: 'Cat 4', desc: 'Fit recreational' },
            { min: 2.5, cat: 'Cat 5', desc: 'Beginner racer' },
            { min: 0, cat: 'Recreational', desc: 'Building fitness' }
        ];

        // W/kg category thresholds (female) - adjusted ~15% lower
        const CATEGORIES_FEMALE = [
            { min: 4.3, cat: 'Pro / Cat 1', desc: 'Elite level' },
            { min: 3.6, cat: 'Cat 2', desc: 'Very strong amateur' },
            { min: 3.2, cat: 'Cat 3', desc: 'Strong recreational' },
            { min: 2.8, cat: 'Cat 4', desc: 'Fit recreational' },
            { min: 2.2, cat: 'Cat 5', desc: 'Beginner racer' },
            { min: 0, cat: 'Recreational', desc: 'Building fitness' }
        ];

        function getRaceFromURL() {
            const params = new URLSearchParams(window.location.search);
            return params.get('race') || params.get('r');
        }

        function initForm() {
            const raceSlug = getRaceFromURL();
            const race = raceSlug ? getNextRaceDate(raceSlug) : null;

            if (race) {
                document.getElementById('race-display').textContent = race.name;
                document.title = `Build Your ${race.name} Training Plan | Gravel God`;
                
                document.getElementById('race_slug').value = raceSlug;
                document.getElementById('race_name').value = race.name;
                document.getElementById('race_date').value = race.date;
                
                if (race.distance) {
                    document.getElementById('race_distance').value = race.distance;
                }
                
                updateWeeksDisplay(race.date);
            } else {
                document.getElementById('race-display').textContent = 'Your Race';
                document.getElementById('race_slug').value = 'custom';
                document.getElementById('race_name').value = 'Custom Race';
            }
        }

        function formatDate(dateStr) {
            const date = new Date(dateStr + 'T00:00:00');
            return date.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
        }

        function updateWeeksDisplay(dateStr) {
            const raceDate = new Date(dateStr + 'T00:00:00');
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const diffTime = raceDate - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            const diffWeeks = Math.floor(diffDays / 7);
            
            const dateHelp = document.getElementById('race-date-help');
            const dateInput = document.getElementById('race_date');
            
            if (diffDays < 0) {
                dateHelp.textContent = '⚠️ Race date is in the past - please select a future date';
                dateHelp.style.color = '#e74c3c';
                dateInput.classList.add('error');
            } else if (diffWeeks < 4) {
                dateHelp.textContent = `⚠️ ${diffWeeks} weeks away - minimum 4 weeks recommended`;
                dateHelp.style.color = '#e74c3c';
                dateInput.classList.add('error');
            } else if (diffWeeks < 8) {
                dateHelp.textContent = `${diffWeeks} weeks away - tight timeline`;
                dateHelp.style.color = '#ffc107';
                dateInput.classList.remove('error');
            } else {
                dateHelp.textContent = `${diffWeeks} weeks away - good build time`;
                dateHelp.style.color = '#4ECDC4';
                dateInput.classList.remove('error');
            }
            
            document.getElementById('weeks_until_race').value = diffWeeks;
        }

        // Calculate W/kg and category
        function calculateMetrics() {
            const ftp = parseFloat(document.getElementById('ftp').value);
            const weight = parseFloat(document.getElementById('weight').value);
            const sex = document.getElementById('sex').value;
            
            const calcDisplay = document.getElementById('calc-display');
            const wpkgEl = document.getElementById('calc-wpkg');
            const catEl = document.getElementById('calc-category');
            
            if (ftp && weight && sex) {
                const weightKg = weight * 0.453592;
                const wpkg = (ftp / weightKg).toFixed(2);
                
                const categories = sex === 'female' ? CATEGORIES_FEMALE : CATEGORIES_MALE;
                const category = categories.find(c => wpkg >= c.min);
                
                wpkgEl.textContent = wpkg + ' W/kg';
                catEl.textContent = category ? `${category.cat} (${category.desc})` : '—';
                
                document.getElementById('watts_per_kg').value = wpkg;
                document.getElementById('estimated_category').value = category ? category.cat : '';
                
                calcDisplay.classList.remove('hidden');
            } else {
                calcDisplay.classList.add('hidden');
            }
        }

        // Blindspot inference
        function inferBlindspots() {
            const blindspots = [];
            
            const sleep = document.getElementById('sleep_quality').value;
            if (sleep === 'poor' || sleep === 'fair') {
                blindspots.push('Recovery Deficit');
            }
            
            const stress = document.getElementById('stress_level').value;
            if (stress === 'high' || stress === 'very_high') {
                blindspots.push('Life Stress Overload');
            }
            
            const strength = document.querySelector('input[name="strength_current"]:checked');
            if (strength && (strength.value === 'none' || strength.value === 'occasional')) {
                blindspots.push('Movement Quality Gap');
            }
            
            const injuries = document.getElementById('injuries').value;
            if (injuries && injuries.trim().length > 0) {
                blindspots.push('Injury Management Required');
            }
            
            const equipment = document.getElementById('strength_equipment').value;
            if (equipment === 'minimal' || equipment === 'none') {
                blindspots.push('Equipment Limitations');
            }
            
            const hours = document.getElementById('hours_per_week').value;
            if (hours === '3-5' || hours === '5-7') {
                blindspots.push('Time-Crunched Reality');
            }
            
            const age = parseInt(document.getElementById('age').value);
            if (age >= 45) {
                blindspots.push('Masters Recovery Window');
            }
            
            document.getElementById('blindspots').value = blindspots.join(',');
            return blindspots;
        }

        // Event listeners
        document.getElementById('race_date').addEventListener('change', function() {
            updateWeeksDisplay(this.value);
        });

        document.getElementById('ftp').addEventListener('input', calculateMetrics);
        document.getElementById('weight').addEventListener('input', calculateMetrics);
        document.getElementById('sex').addEventListener('change', calculateMetrics);

        // Radio option selection styling
        document.querySelectorAll('.radio-option').forEach(option => {
            option.addEventListener('click', function() {
                const input = this.querySelector('input');
                const name = input.name;
                document.querySelectorAll(`.radio-option input[name="${name}"]`).forEach(inp => {
                    inp.closest('.radio-option').classList.remove('selected');
                });
                this.classList.add('selected');
                input.checked = true;
            });
        });

        // Checkbox option selection styling with Flexible logic
        document.querySelectorAll('.checkbox-option').forEach(option => {
            option.addEventListener('click', function(e) {
                const input = this.querySelector('input');
                if (e.target.tagName !== 'INPUT') {
                    input.checked = !input.checked;
                }
                
                const name = input.name;
                const value = input.value;
                const isChecked = input.checked;
                
                // Handle "Flexible" mutual exclusivity
                if (value === 'flexible' && isChecked) {
                    // Uncheck all specific days
                    document.querySelectorAll(`input[name="${name}"]`).forEach(inp => {
                        if (inp.value !== 'flexible') {
                            inp.checked = false;
                            inp.closest('.checkbox-option').classList.remove('selected');
                        }
                    });
                } else if (value !== 'flexible' && isChecked) {
                    // Uncheck "Flexible" if a specific day is selected
                    const flexibleInput = document.querySelector(`input[name="${name}"][value="flexible"]`);
                    if (flexibleInput) {
                        flexibleInput.checked = false;
                        flexibleInput.closest('.checkbox-option').classList.remove('selected');
                    }
                }
                
                this.classList.toggle('selected', input.checked);
            });
        });

        // Form validation
        function validateForm(data) {
            const errors = [];
            
            // Check race date
            const raceDate = new Date(data.race_date + 'T00:00:00');
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            if (raceDate < today) {
                errors.push('Race date cannot be in the past');
            }
            
            const weeksUntil = Math.floor((raceDate - today) / (7 * 24 * 60 * 60 * 1000));
            if (weeksUntil < 4) {
                errors.push('Race must be at least 4 weeks away');
            }
            
            // Check that at least one long ride day is selected
            if (!data.long_ride_days || data.long_ride_days.length === 0) {
                errors.push('Select at least one day for long rides');
            }
            
            // Check that at least one interval day is selected
            if (!data.interval_days || data.interval_days.length === 0) {
                errors.push('Select at least one day for intervals');
            }
            
            return errors;
        }

        // Form submission
        document.getElementById('training-plan-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submit-btn');
            const messageDiv = document.getElementById('message');
            
            // Infer blindspots before submission
            inferBlindspots();
            
            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';
            
            const formData = new FormData(this);
            const data = Object.fromEntries(formData.entries());
            
            // Collect checkbox values as arrays
            data.long_ride_days = formData.getAll('long_ride_days');
            data.interval_days = formData.getAll('interval_days');
            data.off_days = formData.getAll('off_days');
            
            // Honeypot check
            if (data.website) {
                showMessage('error', 'Submission blocked.');
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit & Build My Plan →';
                return;
            }
            
            // Validate
            const errors = validateForm(data);
            if (errors.length > 0) {
                showMessage('error', errors.join('. '));
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit & Build My Plan →';
                return;
            }

            try {
                const WORKER_URL = 'https://training-plan-intake.gravelgodcoaching.workers.dev';
                
                const response = await fetch(WORKER_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                if (response.ok) {
                    showMessage('success', '✓ Got it! I\'ll build your plan and send it to ' + data.email + ' within 24 hours (usually same day).');
                    this.reset();
                    initForm();
                    document.querySelectorAll('.radio-option.selected, .checkbox-option.selected').forEach(el => el.classList.remove('selected'));
                    document.getElementById('calc-display').classList.add('hidden');
                } else {
                    showMessage('error', result.error || 'Something went wrong. Please try again.');
                }
            } catch (error) {
                console.error('Submission error:', error);
                showMessage('error', 'Network error. Please check your connection and try again.');
            }

            submitBtn.disabled = false;
            submitBtn.textContent = 'Submit & Build My Plan →';
        });

        function showMessage(type, text) {
            const messageDiv = document.getElementById('message');
            messageDiv.className = `message ${type}`;
            messageDiv.textContent = text;
            messageDiv.classList.remove('hidden');
            messageDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        // Initialize
        initForm();
    </script>
</body>
</html>
